<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Medical Surveillance Systems</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js" crossorigin="anonymous"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(-45deg, #1a202c, #2d3748, #4a5568, #2d3748);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .input_video { display: none; }
        .output_canvas {
            width: 100%;
            height: auto;
            border-radius: 0.5rem;
        }
        /* Page transition styles */
        .page { display: none; }
        .page.active { display: block; }
        /* Simple focus ring for accessibility */
        textarea:focus, button:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
        }
        .nav-link.active {
            color: #60a5fa; /* A light blue color for active link */
            border-bottom: 2px solid #60a5fa;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">

    <!-- Header and Navigation -->
    <header class="bg-gray-800 shadow-lg sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="text-2xl font-bold text-white">
                üè• <span class="hidden sm:inline">AI Medical Systems</span>
            </div>
            <div class="space-x-4 md:space-x-8 text-lg">
                <button data-page="home" class="nav-link text-gray-300 hover:text-white transition duration-300 pb-1">Home</button>
                <button data-page="about" class="nav-link text-gray-300 hover:text-white transition duration-300 pb-1">About</button>
                <button data-page="support" class="nav-link text-gray-300 hover:text-white transition duration-300 pb-1">Support</button>
                <button data-page="tracker" class="nav-link text-gray-300 hover:text-white transition duration-300 pb-1">Tracker</button>
            </div>
        </nav>
    </header>

    <!-- Main Content Area -->
    <main>
        <!-- Home Page -->
        <div id="home" class="page active">
            <div class="gradient-bg">
                <div class="text-center p-8 md:p-16 max-w-4xl mx-auto">
                    <header class="mb-8">
                        <h1 class="text-4xl md:text-6xl font-black mb-2 tracking-tight">
                            AI-Integrated Medical Surveillance Systems
                        </h1>
                        <h2 class="text-xl md:text-2xl font-semibold text-blue-300 mb-6">
                            Transform Your Clinic with Intelligent Patient Management
                        </h2>
                        <p class="text-lg text-gray-300 max-w-2xl mx-auto">
                            Our computer vision-based platform thinks, tracks, and manages‚Äîso your staff can focus on what truly matters: patient care.
                        </p>
                    </header>
                    <button id="getStartedBtn"
                        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-10 rounded-full text-xl transition-transform transform hover:scale-105 duration-300 shadow-lg">
                        Launch the Tracker
                    </button>
                </div>
            </div>
             <div class="bg-gray-900 py-12 px-6">
                <div class="max-w-5xl mx-auto grid md:grid-cols-2 gap-8">
                    <div class="bg-gray-800 p-6 rounded-lg shadow-xl">
                        <h3 class="text-2xl font-bold mb-3 text-blue-400">The Problem</h3>
                         <ul class="text-left text-gray-300 space-y-2">
                            <li><span class="font-bold text-red-400">‚è∞ Time Loss:</span> 5-10 minutes per patient on manual check-ins.</li>
                            <li><span class="font-bold text-red-400">üìù Error Rate:</span> 15% data entry mistakes lead to complications.</li>
                            <li><span class="font-bold text-red-400">üòì Staff Burnout:</span> Repetitive administrative tasks drain morale.</li>
                            <li><span class="font-bold text-red-400">üí∞ Hidden Costs:</span> Inefficiency results in lost revenue and patient dissatisfaction.</li>
                        </ul>
                    </div>
                     <div class="bg-gray-800 p-6 rounded-lg shadow-xl">
                        <h3 class="text-2xl font-bold mb-3 text-green-400">The Solution</h3>
                        <ul class="text-left text-gray-300 space-y-2">
                            <li>‚úÖ <b>Save 40% of staff time</b> by automating manual processes.</li>
                            <li>‚úÖ <b>AI facial recognition</b> for instant, secure patient check-in.</li>
                            <li>‚úÖ <b>Real-time monitoring</b> and compliance alerts.</li>
                            <li>‚úÖ <b>Measurable ROI:</b> 95% faster check-ins, 87% less wait time.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- About Page -->
        <div id="about" class="page p-6 md:p-12 max-w-5xl mx-auto">
            <h2 class="text-4xl font-bold text-center mb-8 text-blue-400">About Our Technology</h2>
            <div class="space-y-8">
                <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                    <h3 class="text-2xl font-bold mb-3">Our Mission</h3>
                    <p class="text-gray-300 leading-relaxed">
                        Our goal is to revolutionize clinic operations by eliminating the bottlenecks and manual processes that lead to staff burnout and inefficient patient care. We believe that by intelligently automating administrative tasks, we can empower healthcare professionals to dedicate their valuable time to patients, not paperwork. Most clinics waste up to 40% of staff time on these manual processes, and we're here to change that.
                    </p>
                </div>

                <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                    <h3 class="text-2xl font-bold mb-3">Core Capabilities</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-bold text-lg text-blue-300">üîê Smart Patient Recognition</h4>
                            <p class="text-gray-400">AI facial recognition with 99.9% accuracy, even with masks. Instantly retrieves patient history for a seamless experience.</p>
                        </div>
                        <div>
                            <h4 class="font-bold text-lg text-blue-300">‚òÅÔ∏è Automated Check-In System</h4>
                            <p class="text-gray-400">A zero-touch entry process that integrates directly with your EMR or Google Sheets for real-time attendance tracking.</p>
                        </div>
                        <div>
                            <h4 class="font-bold text-lg text-blue-300">üìä Intelligent Monitoring</h4>
                            <p class="text-gray-400">Track multiple patients simultaneously, activate personalized treatment plans, and receive automated compliance alerts.</p>
                        </div>
                        <div>
                            <h4 class="font-bold text-lg text-blue-300">üõ°Ô∏è Enterprise Security</h4>
                            <p class="text-gray-400">Fully HIPAA-compliant with end-to-end encryption, secure cloud storage, and role-based access control to protect patient data.</p>
                        </div>
                    </div>
                </div>
                 <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                    <h3 class="text-2xl font-bold mb-3">Future Innovations</h3>
                    <p class="text-gray-300 mb-4">We are constantly evolving. Our roadmap includes exciting optional add-ons to further enhance clinic capabilities:</p>
                    <ul class="list-disc list-inside text-gray-400 space-y-2">
                        <li><b>Voice Recognition:</b> For completely hands-free system operation.</li>
                        <li><b>Wearable Integration:</b> To stream real-time vitals and activity data.</li>
                        <li><b>Predictive Analytics:</b> To anticipate patient needs and optimize scheduling.</li>
                        <li><b>Mobile Apps:</b> Empowering patients with self-service tools.</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Support Page -->
        <div id="support" class="page p-6 md:p-12 max-w-5xl mx-auto">
            <h2 class="text-4xl font-bold text-center mb-8 text-blue-400">Support & Partnership</h2>
            <div class="space-y-8">
                <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                    <h3 class="text-2xl font-bold mb-3">Frequently Asked Questions</h3>
                    <div class="space-y-4">
                        <div>
                            <h4 class="font-semibold text-lg text-blue-300">Is it secure?</h4>
                            <p class="text-gray-400">Absolutely. Our system exceeds HIPAA requirements with end-to-end encryption and undergoes regular third-party security audits.</p>
                        </div>
                        <div>
                            <h4 class="font-semibold text-lg text-blue-300">Will it work with our existing systems?</h4>
                            <p class="text-gray-400">Yes. We use an API-first architecture designed to integrate with all major EMRs. No system replacement is needed.</p>
                        </div>
                        <div>
                            <h4 class="font-semibold text-lg text-blue-300">What about the cost?</h4>
                            <p class="text-gray-400">We offer modular pricing so you only pay for what you use. Most clinics see a full return on investment within 3-6 months with no large upfront capital required.</p>
                        </div>
                    </div>
                </div>

                <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                    <h3 class="text-2xl font-bold mb-3">Risk-Free Pilot Program</h3>
                    <p class="text-gray-300 mb-4">Experience the benefits firsthand with our structured pilot program. We make it easy to see the value before committing.</p>
                    <ol class="list-decimal list-inside text-gray-400 space-y-2">
                        <li><b>Weeks 1-2: Setup & Training.</b> Quick system configuration and a 2-hour staff orientation.</li>
                        <li><b>Weeks 3-4: Live Trial.</b> We monitor performance, gather feedback, and optimize workflows with you.</li>
                        <li><b>Week 5: Decision Point.</b> We review the metrics and ROI together to plan your full deployment.</li>
                    </ol>
                </div>
                
                <div class="bg-gray-800 p-6 rounded-lg shadow-lg text-center">
                    <h3 class="text-2xl font-bold mb-3">Contact Us</h3>
                    <p class="text-gray-300 mb-4">Ready to transform your clinic? Schedule a personalized demo or start your risk-free pilot today.</p>
                    <a href="mailto:support@aimedicalsystems.com" class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300">
                        Email Support
                    </a>
                </div>
            </div>
        </div>

        <!-- Tracker App Page -->
        <div id="tracker" class="page w-full max-w-5xl mx-auto p-4">
            <div class="bg-gray-800 p-4 rounded-lg shadow-lg">
                <div class="relative">
                    <video class="input_video"></video>
                    <canvas class="output_canvas" width="1280px" height="720px"></canvas>
                    <div id="loading" class="absolute top-0 left-0 w-full h-full bg-gray-900 bg-opacity-75 flex justify-center items-center rounded-lg hidden">
                        <div class="loader ease-linear rounded-full border-8 border-t-8 border-gray-200 h-32 w-32 animate-spin"></div>
                    </div>
                </div>
                <textarea id="inputTextBox"
                          class="mt-4 p-4 w-full bg-gray-900 rounded-lg text-gray-300 border border-gray-700 transition"
                          rows="3"
                          placeholder="Type a command (e.g., 'do a pushup') and press Enter..."></textarea>
                <div class="flex justify-center items-center space-x-4 mt-4">
                    <button id="startButton" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                        Start Tracking
                    </button>
                    <button id="stopButton" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300" disabled>
                        Stop Tracking
                    </button>
                </div>
            </div>
        </div>
    </main>
    
    <footer class="text-center py-6 text-gray-500 text-sm">
        &copy; 2024 AI-Integrated Medical Surveillance Systems. All rights reserved.
    </footer>

    <script type="module">
        // --- Page Navigation Logic ---
        const pages = document.querySelectorAll('.page');
        const navLinks = document.querySelectorAll('.nav-link');
        const getStartedBtn = document.getElementById('getStartedBtn');

        function showPage(pageId) {
            // Stop camera if navigating away from tracker
            if (document.getElementById('tracker').classList.contains('active') && pageId !== 'tracker') {
                stopTracking();
            }
            
            pages.forEach(page => {
                page.classList.toggle('active', page.id === pageId);
            });
            navLinks.forEach(link => {
                link.classList.toggle('active', link.dataset.page === pageId);
            });
            window.scrollTo(0, 0); // Scroll to top on page change
        }

        navLinks.forEach(link => {
            link.addEventListener('click', () => showPage(link.dataset.page));
        });
        
        getStartedBtn.addEventListener('click', () => showPage('tracker'));

        // Set initial page
        showPage('home');

        // --- Pose Tracker Elements ---
        const videoElement = document.getElementsByClassName('input_video')[0];
        const canvasElement = document.getElementsByClassName('output_canvas')[0];
        const canvasCtx = canvasElement.getContext('2d');
        const startButton = document.getElementById('startButton');
        const stopButton = document.getElementById('stopButton');
        const loadingElement = document.getElementById('loading');
        const inputTextBox = document.getElementById('inputTextBox');

        let camera = null;
        let pose = null;
        let displayText = '';

        // --- Action Recognition State ---
        let actionSequence = null;
        let currentStepIndex = 0;

        // --- Landmark Name Mapping ---
        const landmarkNames = [
            'nose', 'left_eye_inner', 'left_eye', 'left_eye_outer', 'right_eye_inner', 'right_eye', 'right_eye_outer',
            'left_ear', 'right_ear', 'mouth_left', 'mouth_right', 'left_shoulder', 'right_shoulder', 'left_elbow',
            'right_elbow', 'left_wrist', 'right_wrist', 'left_pinky', 'right_pinky', 'left_index', 'right_index',
            'left_thumb', 'right_thumb', 'left_hip', 'right_hip', 'left_knee', 'right_knee', 'left_ankle', 'right_ankle',
            'left_heel', 'right_heel', 'left_foot_index', 'right_foot_index'
        ];

        // --- Condition Checking Logic ---
        function checkCondition(condition, landmarks) {
            const l1 = landmarks[landmarkNames.indexOf(condition.landmark1)];
            const l2 = landmarks[landmarkNames.indexOf(condition.landmark2)];
            if (!l1 || !l2) return false; // Landmark not visible

            const threshold = condition.threshold || 0.05; // Default proximity threshold

            switch (condition.relationship) {
                case 'is_above': return l1.y < l2.y;
                case 'is_below': return l1.y > l2.y;
                case 'is_left_of': return l1.x < l2.x;
                case 'is_right_of': return l1.x > l2.x;
                case 'is_close_to': {
                    const dx = l1.x - l2.x;
                    const dy = l1.y - l2.y;
                    return Math.sqrt(dx * dx + dy * dy) < threshold;
                }
                default: return false;
            }
        }

        // --- Pose Tracker Logic ---
        function onResults(results) {
            canvasCtx.save();
            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
            canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);

            if (results.poseLandmarks) {
                if (actionSequence && actionSequence.steps[currentStepIndex]) {
                    const currentStep = actionSequence.steps[currentStepIndex];
                    let allConditionsMet = true;
                    for (const condition of currentStep.conditions) {
                        if (!checkCondition(condition, results.poseLandmarks)) {
                            allConditionsMet = false;
                            break;
                        }
                    }

                    if (allConditionsMet) {
                        currentStepIndex++;
                        if (currentStepIndex >= actionSequence.steps.length) {
                            displayText = `${actionSequence.actionName} Complete!`;
                            actionSequence = null;
                            currentStepIndex = 0;
                            setTimeout(() => { displayText = ''; }, 2000);
                        } else {
                            displayText = actionSequence.steps[currentStepIndex].instruction;
                        }
                    }
                }

                drawConnectors(canvasCtx, results.poseLandmarks, POSE_CONNECTIONS, { color: '#00FF00', lineWidth: 4 });
                drawLandmarks(canvasCtx, results.poseLandmarks, { color: '#FF0000', radius: 2 });
            }

            if (displayText) {
                canvasCtx.fillStyle = 'white';
                canvasCtx.strokeStyle = 'black';
                canvasCtx.lineWidth = 5;
                canvasCtx.font = 'bold 60px Inter';
                canvasCtx.textAlign = 'center';
                const x = canvasElement.width / 2;
                const y = canvasElement.height - 60;
                canvasCtx.strokeText(displayText, x, y);
                canvasCtx.fillText(displayText, x, y);
            }
            canvasCtx.restore();
        }

        function initializePose() {
            pose = new Pose({ locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}` });
            pose.setOptions({ modelComplexity: 1, smoothLandmarks: true, minDetectionConfidence: 0.6, minTrackingConfidence: 0.6 });
            pose.onResults(onResults);
        }

        async function startTracking() {
            loadingElement.classList.remove('hidden');
            startButton.disabled = true;
            if (!pose) initializePose();
            camera = new Camera(videoElement, { onFrame: async () => await pose.send({ image: videoElement }), width: 1280, height: 720 });
            try {
                await camera.start();
                loadingElement.classList.add('hidden');
                stopButton.disabled = false;
            } catch (error) {
                console.error("Failed to start camera:", error);
                loadingElement.classList.add('hidden');
                startButton.disabled = false;
            }
        }

        function stopTracking() {
            if (camera) { camera.stop(); camera = null; }
            displayText = '';
            actionSequence = null;
            currentStepIndex = 0;
            if(canvasCtx) canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
            startButton.disabled = false;
            stopButton.disabled = true;
        }

        // --- Gemini API Call ---
        async function getActionSequenceFromAI(command) {
            displayText = 'Analyzing action...';
            const apiKey = ""; // Leave empty
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            const prompt = `
                You are a virtual fitness coach. Your task is to take a user's command and break it down into a sequence of simple, checkable body poses.
                Respond with ONLY a JSON object that follows this exact schema. Do not include any other text or markdown.

                The user wants to perform the action: "${command}"

                The available landmarks are: ${landmarkNames.join(', ')}.
                The available relationships are: 'is_above', 'is_below', 'is_left_of', 'is_right_of', 'is_close_to'.

                The JSON response must have an "actionName", and a "steps" array. Each step must have a "name", an "instruction" for the user, and an array of "conditions".
                Each condition must have a "landmark1", a "landmark2", and a "relationship". For 'is_close_to', you can optionally add a "threshold" (0.0 to 1.0, default is 0.05).
                Keep the instructions short and clear. Make the sequence logical for performing the action.
            `;

            const payload = {
                contents: [{ role: "user", parts: [{ text: prompt }] }],
                generationConfig: { responseMimeType: "application/json" }
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error(`API call failed with status: ${response.status}`);
                const result = await response.json();

                if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts[0]) {
                    const jsonText = result.candidates[0].content.parts[0].text;
                    return JSON.parse(jsonText);
                } else {
                    throw new Error("Invalid response structure from AI.");
                }
            } catch (error) {
                console.error("Error fetching from AI:", error);
                displayText = "Sorry, I couldn't understand that action.";
                setTimeout(() => { displayText = ''; }, 3000);
                return null;
            }
        }

        // --- Event Listeners ---
        startButton.addEventListener('click', startTracking);
        stopButton.addEventListener('click', stopTracking);
        
        inputTextBox.addEventListener('keydown', async (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                const command = inputTextBox.value.trim();
                if (command === '') return;
                
                inputTextBox.value = '';
                stopTracking();
                await startTracking();

                actionSequence = await getActionSequenceFromAI(command);
                
                if (actionSequence && actionSequence.steps && actionSequence.steps.length > 0) {
                    currentStepIndex = 0;
                    displayText = actionSequence.steps[0].instruction;
                }
            }
        });

        window.addEventListener('beforeunload', () => { if (camera) camera.stop(); });
    </script>
</body>
</html>
